{% extends "base.html" %}
{% block title %}Smart Reports - Historial de Campanas{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Historial de Campanas</h1>
    <a href="{{ url_for('upload.upload_page') }}" class="btn btn-primary">Subir Archivos</a>
</div>

{% if campaigns %}
<div class="campaigns-grid">
    {% for item in campaigns %}
    <div class="campaign-card">
        <div class="campaign-header">
            <h2>{{ item.campaign.name }}</h2>
            {% if item.campaign.brand_display %}
            <span class="brand-badge">{{ item.campaign.brand_display }}</span>
            {% endif %}
        </div>
        <div class="campaign-meta">
            {% if item.last_run %}
            <div class="meta-row">
                <span class="meta-label">Ultima actualizacion de datos:</span>
                <span class="meta-value">{{ item.last_run.created_at.strftime('%d/%m/%Y') }}</span>
            </div>
            <div class="meta-row">
                <span class="meta-label">Filas:</span>
                <span class="meta-value">{{ "{:,}".format(item.last_run.total_rows) }}</span>
            </div>
            <div class="meta-row">
                <span class="meta-label">Plataformas:</span>
                <span class="meta-value">{{ item.last_run.platforms }}</span>
            </div>
            <div class="meta-row">
                <span class="meta-label">Estado:</span>
                <span class="status-badge status-{{ item.last_run.status }}">{{ item.last_run.status }}</span>
            </div>
            {% else %}
            <div class="meta-row">
                <span class="meta-label">Sin ejecuciones</span>
            </div>
            {% endif %}
        </div>
        <div class="campaign-actions">
            <a href="{{ url_for('upload.upload_update_mode', campaign_slug=item.campaign.slug) }}" class="btn btn-sm">Actualizar Data</a>
            {% if item.last_run and item.last_run.status == 'completed' %}
            <a href="{{ url_for('dashboard.dashboard', run_id=item.last_run_id) }}" class="btn btn-sm btn-accent">Dashboard</a>
            <a href="{{ url_for('download.download_excel', run_id=item.last_run_id) }}" class="btn btn-sm">Excel</a>
            <a href="{{ url_for('dashboard.dashboard', run_id=item.last_run_id) }}?print=1" class="btn btn-sm">PDF</a>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <div class="empty-icon">ðŸ“Š</div>
    <h2>No hay campanas todavia</h2>
    <p>Suba archivos CSV o Excel para crear la primera campana</p>
    <a href="{{ url_for('upload.upload_page') }}" class="btn btn-primary">Subir Archivos</a>
</div>
{% endif %}
{% endblock %}
